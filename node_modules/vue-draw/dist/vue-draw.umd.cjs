(function(m,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],u):(m=typeof globalThis<"u"?globalThis:m||self,u(m.VueDraw={},m.Vue))})(this,function(m,u){"use strict";function M(e){return{all:e=e||new Map,on:function(n,a){var s=e.get(n);s?s.push(a):e.set(n,[a])},off:function(n,a){var s=e.get(n);s&&(a?s.splice(s.indexOf(a)>>>0,1):e.set(n,[]))},emit:function(n,a){var s=e.get(n);s&&s.slice().map(function(t){t(a)}),(s=e.get("*"))&&s.slice().map(function(t){t(n,a)})}}}function P(){function e(t){if(t instanceof MouseEvent)return n(t);if(t instanceof TouchEvent)return a(t);throw new Error("Invalid event type")}function n(t){if(!(t.target instanceof HTMLElement))return{x:t==null?void 0:t.pageX,y:t==null?void 0:t.pageY};const{left:r,top:i}=t.target.getBoundingClientRect();return{x:(t==null?void 0:t.pageX)-r,y:(t==null?void 0:t.pageY)-i}}function a(t){const r=t.touches[0];if(!(t.target instanceof HTMLElement))return{x:r==null?void 0:r.pageX,y:r==null?void 0:r.pageY};const{left:i,top:d}=t.target.getBoundingClientRect();return{x:(r==null?void 0:r.pageX)-i,y:(r==null?void 0:r.pageY)-d}}function s(t,r){return[t.x,t.y,r.thickness,r.color,r.lineCap,r.erase]}return{getCursorCoords:e,getMouseCoords:n,getTouchCoords:a,createDrawingPoint:s}}function A(e){return u.getCurrentScope()?(u.onScopeDispose(e),!0):!1}function I(e){return typeof e=="function"?e():u.unref(e)}const U=typeof window<"u"&&typeof document<"u";function B(e){var n;const a=I(e);return(n=a==null?void 0:a.$el)!=null?n:a}const N=U?window:void 0;function V(){const e=u.ref(!1);return u.getCurrentInstance()&&u.onMounted(()=>{e.value=!0}),e}function W(e){const n=V();return u.computed(()=>(n.value,!!e()))}function F(e,n,a={}){const{window:s=N,...t}=a;let r;const i=W(()=>s&&"ResizeObserver"in s),d=()=>{r&&(r.disconnect(),r=void 0)},f=u.computed(()=>Array.isArray(e)?e.map(w=>B(w)):[B(e)]),h=u.watch(f,w=>{if(d(),i.value&&s){r=new ResizeObserver(n);for(const p of w)p&&r.observe(p,t)}},{immediate:!0,flush:"post",deep:!0}),g=()=>{d(),h()};return A(g),{isSupported:i,stop:g}}const $=0;function q(e){return e instanceof TouchEvent?!0:e.button===$}const H=()=>window.devicePixelRatio||1,K=()=>"ontouchstart"in window,{getCursorCoords:j}=P(),G="#ffffff",b={thickness:5,color:"#000000",lineCap:"round",erase:!1};function J(){const e=u.ref(null),n=u.ref(null),{on:a,off:s,emit:t}=M();u.onMounted(()=>{if(!e.value)throw new Error("Canvas ref is null");r(),F(e.value.parentElement,o=>{const c=o[0],{width:l,height:_}=c.contentRect;L({width:l,height:_}),u.nextTick(i)})});function r(o){var l;const c=(o==null?void 0:o.getContext("2d"))||((l=e.value)==null?void 0:l.getContext("2d"));c&&(n.value=c)}function i(){if(d(),K())return g();f()}function d(){h(),w()}function f(){e.value&&(e.value.addEventListener("mousedown",p),e.value.addEventListener("mouseup",C),e.value.addEventListener("mouseout",E),e.value.addEventListener("mousemove",D))}function h(){e.value&&(e.value.removeEventListener("mousedown",p),e.value.removeEventListener("mouseup",C),e.value.removeEventListener("mouseout",E),e.value.removeEventListener("mousemove",D))}function g(){e.value&&(e.value.addEventListener("touchstart",p,{passive:!0}),e.value.addEventListener("touchend",C,{passive:!0}),e.value.addEventListener("touchcancel",E,{passive:!0}),e.value.addEventListener("touchmove",D,{passive:!0}))}function w(){e.value&&(e.value.removeEventListener("touchstart",p),e.value.removeEventListener("touchend",C),e.value.removeEventListener("touchcancel",E),e.value.removeEventListener("touchmove",D))}function p(o){k(q(o),"cursor:start",o)}function C(o){k(q(o),"cursor:stop",o)}function E(o){v("cursor:cancel",o)}function D(o){v("cursor:move",o)}function y(o){if(!n.value)return;const c=o[0],[l,_]=c;n.value.beginPath(),n.value.moveTo(l,_);for(let O=1;O<o.length;O++){const oe=o[O],[X,Y,ae,ue,se]=oe;n.value.lineWidth=ae||b.thickness,n.value.strokeStyle=ue||b.color,n.value.lineCap=se||b.lineCap;const z=o[O+1];if(!z)break;const[ie,ce]=z,le=(X+ie)/2,fe=(Y+ce)/2;n.value.quadraticCurveTo(X,Y,le,fe)}const T=o[o.length-1],[R,re]=T;n.value.lineTo(R,re),n.value.stroke()}function x(o){n.value&&(S(),o.forEach(c=>{y(c)}))}function S(){!e.value||!n.value||n.value.clearRect(0,0,e.value.width,e.value.height)}function L({width:o,height:c}){if(!e.value)return;const l=H();e.value.width=o*l,e.value.height=c*l,e.value.style.width=`${o}px`,e.value.style.height=`${c}px`,t("resize",{width:o,height:c}),n.value&&n.value.setTransform(l,0,0,l,0,0)}function v(o,c){t(o,j(c))}function k(o,c,l){o&&v(c,l)}function te(o="image/png",c=1){return new Promise((l,_)=>{var T;if(!e.value||!n.value)return _("Canvas ref is null");n.value.globalCompositeOperation="destination-over",n.value.fillStyle=G,n.value.fillRect(0,0,e.value.width,e.value.height),n.value.globalCompositeOperation="source-over",(T=e.value)==null||T.toBlob(R=>{if(!R)return _("Blob is null");l(R)},o,c)})}return{canvasRef:e,ctxRef:n,DrawingCanvasStroke:y,DrawingCanvas:x,clearCanvas:S,resizeCanvas:L,renderCanvas:te,on:a,off:s}}function Q(){const e=u.ref(!1),n=u.ref(null),a=u.ref([]);function s(){e.value=!0}function t(){e.value=!1,i(),d()}function r(f){n.value||(n.value=[f]),n.value.push(f)}function i(){n.value&&a.value.push(n.value)}function d(){n.value=null}return{isDrawing:e,currentStroke:n,drawing:a,startDrawingState:s,stopDrawingState:t,addDrawingPoint:r}}function Z(){const{canvasRef:e,DrawingCanvasStroke:n,DrawingCanvas:a,renderCanvas:s,clearCanvas:t,on:r}=J(),{isDrawing:i,currentStroke:d,drawing:f,startDrawingState:h,stopDrawingState:g,addDrawingPoint:w}=Q(),{createDrawingPoint:p}=P();let C={thickness:5,color:"#000000",lineCap:"round",erase:!1};const{on:E,emit:D}=M();r("cursor:start",v=>{i.value||(h(),x(v))}),r("cursor:stop",()=>{i.value&&(g(),a(f.value))}),r("cursor:move",v=>{i.value&&x(v)}),r("cursor:cancel",()=>{i.value&&g()}),r("resize",()=>a(f.value));function y(v){i.value&&(w(v),d.value&&(n(d.value),D("drawing",{point:v,drawing:f.value})))}function x(v){if(!i.value)return;const k=p(v,C);y(k)}function S(v){C={...C,...v}}function L(){f.value=[],t()}return{canvasRef:e,isDrawing:i,drawing:f,setOptions:S,renderCanvas:s,resetCanvas:L,on:E}}const ee=u.defineComponent({__name:"DrawingCanvas",props:{thickness:{type:Number,required:!1,default:3},background:{type:String,required:!1,default:"white"},color:{type:String,required:!1,default:"black"},colorName:{type:String,required:!1},lineCap:{type:null,required:!1,default:"round"},erase:{type:Boolean,required:!1,default:!1}},setup(e,{expose:n}){const a=e;u.useCssVars(p=>({"80c87c34-canvasBackgroundColor":w.value}));const{thickness:s,background:t,color:r,erase:i}=u.toRefs(a),{canvasRef:d,setOptions:f,renderCanvas:h,resetCanvas:g}=Z();u.watchEffect(()=>{f({thickness:s.value,color:i.value?"white":r.value,lineCap:"round",erase:i.value})}),n({renderCanvas:h,resetCanvas:g});const w=u.computed(()=>t.value);return(p,C)=>(u.openBlock(),u.createElementBlock("canvas",{ref_key:"canvasRef",ref:d,class:"canvas"},null,512))}}),ve="",ne=((e,n)=>{const a=e.__vccOpts||e;for(const[s,t]of n)a[s]=t;return a})(ee,[["__scopeId","data-v-80c87c34"],["__file","/home/daniel/Proyectos/vue-draw/src/components/DrawingCanvas.vue"]]);m.DrawingCanvas=ne,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
